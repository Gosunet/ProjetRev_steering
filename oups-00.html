<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>A-FRAME : Basic scene</title>
	<style>
   		 canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
			background-color: #aa0000;
    	}
	</style>
    <script src="dist/aframe-master.min.js"></script>
 </head>
 <body>

  <a-scene id="scene">
        <!-- Le décor -->
        <!-- ======== -->

        <a-assets>
          <a-asset-item id="chair-obj" src="assets/models/chair/chair.obj"></a-asset-item>
          <a-asset-item id="chair-mtl" src="assets/models/chair/chair.mtl"></a-asset-item>

          <a-asset-item id="tux-obj" src="assets/models/penguin/penguin.obj"></a-asset-item>
          <a-asset-item id="tux-mtl" src="assets/models/penguin/penguin.mtl"></a-asset-item>


         <a-asset-item id="murs-obj" src="assets/models/murs.obj"></a-asset-item>

        </a-assets>

        <a-camera id="camera" fov="50.0"></a-camera>


        <a-entity 
		obj-model="obj: #chair-obj; mtl: #chair-mtl" 
		position = "0 0 0"  scale="0.01 0.01 0.01" rotation = "0 90 0" ></a-entity>

       <a-entity id="penguin"
		obj-model="obj: #tux-obj; mtl: #tux-mtl" 
		position = "0 0 -3"   rotation = "0 90 0" ></a-entity>	

        <a-entity 
		obj-model="obj: #murs-obj; mtl: #chair-mtl" 
        ></a-entity>

       <a-image src="assets/textures/plage.jpg"
                width="3" height="2"
                position="2 2 -9.9"></a-image>

      <a-plane width="3" height="2" color="#AAC" 
               position="-3 2 -9.9"></a-plane>

      <a-image id="Sol" width="30" height="20" rotation="-90 0 0" src="assets/textures/plage.jpg"></a-image>


     	<!-- on place un repère dans la scène -->
        <!-- ================================ -->

  		<a-cylinder height="3.0" color="green"  radius="0.05" position="0.0 1.5 0.0"></a-cylinder>
  		<a-cylinder height="3.0" color="red"    radius="0.05" position="1.5 0.0 0.0"  rotation="0 0 -90"></a-cylinder>
  		<a-cylinder height="3.0" color="blue"   radius="0.05" position="0.0 0.0 1.5"  rotation="90 0 0"></a-cylinder>
    
		<a-sphere radius="0.2" color="red"   position="4 0 0"></a-sphere>
		<a-sphere radius="0.2" color="green" position="0 4 0"></a-sphere>
		<a-sphere radius="0.2" color="blue"  position="0 0 4"></a-sphere>

        <!-- on place les cibles dans la scène -->
        <!-- ================================ -->
        <a-entity id="cible01" position="0 0.5 0">
			<a-sphere radius="0.5" tranparent opacity="0.5" color="orange"></a-sphere>
		</a-entity>

		<a-entity id="cible02" position="2 0.5 -7">
			<a-sphere radius="0.5" tranparent opacity="0.5" color="orange"></a-sphere>
		</a-entity>

		<a-entity id="cible00" position="-2 0.5 -7">
			<a-sphere radius="0.5" tranparent opacity="0.5" color="orange"></a-sphere>
		</a-entity>

        <a-entity id="cible04" position="10 0.5 2">
			<a-sphere radius="0.5" tranparent opacity="0.5" color="orange"></a-sphere>
		</a-entity>

		<a-entity id="cible05" position="-10 0.5 2">
			<a-sphere radius="0.5" tranparent opacity="0.5" color="orange"></a-sphere>
		</a-entity>
  </a-scene>

<script src="js/vec3.js"></script>
<script>
		var scene = document.querySelector('a-scene');

		// alert("PRET ? ");

		var tux00 = document.getElementById('penguin');

		var update_fct = function () {
			var cible = document.getElementById(this.chemin[this.idx]);
			var C = cible.getAttribute("position");
			var P = this.gr.getAttribute('position');


			var Fs = vec3Creer();
			vec3Moins(Fs, C, P);
			var distance = vec3Norme(Fs);
			vec3Normaliser(Fs);

			if (distance < 0.25) {
				if (this.idx == this.chemin.length - 1) {} else {
					this.idx++;
					cible = document.getElementById(this.chemin[this.idx]);
					var C = cible.getAttribute("position");
				}
			}

			var k = 1.0;

			if (this.idx == this.chemin.length - 1)
				if (distance < 2.0)
					k = distance / 2.0;

			vec3Scale(Fs, k * this.vMax);
			vec3Moins(Fs, Fs, this.vitesse);

			var l = vec3Norme(Fs);
			vec3Normaliser(Fs);
			vec3Scale(Fs, Math.min(l, this.fMax));

			vec3Accumuler(P, 0.2, this.vitesse);

			vec3Accumuler(this.vitesse, 0.2, Fs);
			this.vit = vec3Norme(this.vitesse);

			this.gr.setAttribute('position', P);

			if (this.vit > 0.00001) {
				var rot = this.gr.getAttribute('rotation');
				var angleRadian = Math.atan2(-this.vitesse.z, this.vitesse.x);
				rot.y = angleRadian * 180.0 / Math.PI;
				this.gr.setAttribute('rotation', rot);
			}
		}
		tux0 = {
			cap: 0.0,
			vit: 0.05,
			vMax: 0.5,
			fMax: 0.1,
			vitesse: {
				x: 0.05 * Math.cos(0.0),
				y: 0.0,
				z: 0.05 * Math.sin(0.0)
			},
			acceleration: {
				x: 0.0,
				y: 0.0,
				z: 0.0
			},
			chemin: ["camera","cible00", "cible02", "cible01", "cible04", "cible05"],
			idx: 0,
			gr: tux00,
			update: update_fct
		};
		setInterval(anim, 20);

		function anim() {
			tux0.update();
		}
	</script>
 </body>
</html>
